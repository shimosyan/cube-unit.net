plan_workflow_name: terraform-pull-request

tflint:
  enabled: true
  fix: true
trivy:
  enabled: true

target_groups:
#
# AWS
#
  - working_directory: terraform/aws/cube-unit.net
    target: terraform/aws/cube-unit.net
    aws_region: ap-northeast-1
    terraform_plan_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_cube-unit.net_terraform_plan
    terraform_apply_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_cube-unit.net_terraform_apply

  - working_directory: terraform/aws/stg.cube-unit.net
    target: terraform/aws/stg.cube-unit.net
    aws_region: ap-northeast-1
    terraform_plan_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_cube-unit.net_terraform_plan
    terraform_apply_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_cube-unit.net_terraform_apply

  - working_directory: terraform/aws/img.cube-unit.net
    target: terraform/aws/img.cube-unit.net
    aws_region: ap-northeast-1
    terraform_plan_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_cube-unit.net_terraform_plan
    terraform_apply_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_cube-unit.net_terraform_apply

  - working_directory: terraform/aws/static.cube-unit.net
    target: terraform/aws/static.cube-unit.net
    aws_region: ap-northeast-1
    terraform_plan_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_cube-unit.net_terraform_plan
    terraform_apply_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_cube-unit.net_terraform_apply

#
# Cloudflare
# cube-unit.net
#
  - working_directory: terraform/cloudflare/cube-unit.net/dns
    target: terraform/cloudflare/cube-unit.net/dns
    aws_region: ap-northeast-1
    terraform_plan_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_cube-unit.net_terraform_plan
      secrets:
        - env_name: CLOUDFLARE_API_TOKEN
          secret_name: CLOUDFLARE_READ_ONLY_API_TOKEN
    terraform_apply_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_cube-unit.net_terraform_apply
      secrets:
        - env_name: CLOUDFLARE_API_TOKEN
          secret_name: CLOUDFLARE_WRITABLE_API_TOKEN

#
# Cloudflare
# micmnis.net
#
  - working_directory: terraform/cloudflare/micmnis.net/dns
    target: terraform/cloudflare/micmnis.net/dns
    aws_region: ap-northeast-1
    terraform_plan_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_cube-unit.net_terraform_plan
      secrets:
        - env_name: CLOUDFLARE_API_TOKEN
          secret_name: CLOUDFLARE_READ_ONLY_API_TOKEN
    terraform_apply_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_cube-unit.net_terraform_apply
      secrets:
        - env_name: CLOUDFLARE_API_TOKEN
          secret_name: CLOUDFLARE_WRITABLE_API_TOKEN
