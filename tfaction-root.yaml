# yaml-language-server: $schema=https://raw.githubusercontent.com/suzuki-shunsuke/tfaction/refs/tags/v1.15.5/schema/tfaction-root.json

plan_workflow_name: Pull Request

tflint:
  enabled: true
  fix: true
trivy:
  enabled: true

drift_detection:
  enabled: true

target_groups:
#
# AWS
#
  - working_directory: terraform/aws
    target: aws
    aws_region: ap-northeast-1
    terraform_plan_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_cube-unit.net_terraform_plan
    terraform_apply_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_cube-unit.net_terraform_apply

#
# Cloudflare
#
  - working_directory: terraform/cloudflare
    target: cloudflare
    aws_region: ap-northeast-1
    terraform_plan_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_cube-unit.net_terraform_plan
      secrets:
        - env_name: CLOUDFLARE_API_TOKEN
          secret_name: CLOUDFLARE_READ_ONLY_API_TOKEN # Account Scope API Token は利用できないため、User Scope API Token が必要
    terraform_apply_config:
      aws_assume_role_arn: arn:aws:iam::158677943024:role/github_cube-unit.net_terraform_apply
      secrets:
        - env_name: CLOUDFLARE_API_TOKEN
          secret_name: CLOUDFLARE_WRITABLE_API_TOKEN # Account Scope API Token は利用できないため、User Scope API Token が必要
